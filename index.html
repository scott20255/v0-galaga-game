<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GALAGA – vibe coding (v0.app ready)</title>
  <style>
    :root { --bg:#05060a; --fg:#e6f0ff; --accent:#61dafb; --hit:#ff5577; --good:#94f7a6; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 50% 10%, #0b1020 0%, #05060a 60%, #000 100%);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Pretendard,Helvetica,Arial,sans-serif}
    .wrap{display:flex;flex-direction:column;align-items:center;gap:8px;padding:10px}
    h1{font-size:18px;margin:8px 0 0;letter-spacing:1px}
    canvas{background:transparent;border-radius:16px;border:1px solid #1a2238;box-shadow:0 10px 35px rgba(0,0,0,.45), inset 0 0 40px rgba(97,218,251,.05)}
    .hud{display:flex;gap:14px;align-items:center;flex-wrap:wrap;justify-content:center}
    .pill{padding:6px 10px;border:1px solid #1f2a44;border-radius:999px;background:rgba(255,255,255,.03)}
    .btn{cursor:pointer}
    a{color:var(--accent)}
    .muted{opacity:.7}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>SPACE SHOOTER · GALAGA vibe</h1>
    <div class="hud">
      <div class="pill" id="score">SCORE 0</div>
      <div class="pill" id="lives">LIVES 3</div>
      <div class="pill" id="stage">STAGE 1</div>
      <div class="pill muted">◀ ▶ 이동 · SPACE/▲ 발사 · P 일시정지</div>
      <div class="pill btn" id="restart">RESTART</div>
    </div>
    <canvas id="game" width="800" height="1000"></canvas>
    <div class="muted">Single‑file canvas build • no assets • drop into <a href="https://v0.app" target="_blank" rel="noreferrer">v0.app</a> or any static host.</div>
  </div>

  <script>
  // ===== GALAGA‑LIKE (compact, commented) =====
  const C = document.getElementById('game');
  const X = C.getContext('2d');
  const ui = {score:0, lives:3, stage:1, paused:false};
  const K = {Left:false, Right:false, Fire:false};
  const S = {W:800, H:1000, scale:1};

  // Resize to device while keeping aspect
  function fit(){
    const maxW = Math.min(window.innerWidth-20, 820);
    const scale = maxW / C.width; S.scale = scale;
    C.style.width = C.width * scale + 'px';
    C.style.height = C.height * scale + 'px';
  } window.addEventListener('resize', fit); fit();

  // --- Utilities
  const rnd = (a=1,b=0)=>Math.random()*(a-b)+b;
  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  // --- Stars background
  const stars=[...Array(160)].map(()=>({x:rnd(S.W),y:rnd(S.H),z:rnd(1,0.2)}));
  function drawStars(dt){
    for(const s of stars){ s.y+= 12*s.z*dt; if(s.y>S.H) s.y=0, s.x=rnd(S.W); }
    X.save(); X.fillStyle='#89a';
    for(const s of stars){ X.globalAlpha=s.z; X.fillRect(s.x, s.y, 2, 2); }
    X.restore();
  }

  // --- Entities
  const bullets=[]; const ebullets=[]; const enemies=[]; const particles=[]; const drops=[];

  const player = {x:S.W/2, y:S.H-80, vx:0, speed:420, w:26, h:22, cd:0, power:1, twin:false, inv:0};

  function playerDraw(){
    X.save(); X.translate(player.x, player.y);
    if(player.inv>0){ X.globalAlpha = 0.5 + 0.5*Math.cos(t*20); }
    // ship
    X.fillStyle = '#fff';
    X.beginPath(); X.moveTo(0,-18); X.lineTo(14,16); X.lineTo(0,10); X.lineTo(-14,16); X.closePath(); X.fill();
    X.fillStyle = '#ff3b3b'; X.fillRect(-3,-6,6,12); // body stripe
    if(player.twin){ X.fillStyle='#9cf'; X.fillRect(-20,2,40,3); }
    X.restore();
  }
  function playerUpdate(dt){
    player.vx = (K.Left?-1:0) + (K.Right?1:0);
    player.x = clamp(player.x + player.vx*player.speed*dt, 28, S.W-28);
    player.cd = Math.max(0, player.cd-dt);
    player.inv = Math.max(0, player.inv-dt);
    if(K.Fire && player.cd===0){
      fire(player.x, player.y-22);
      if(player.twin) { fire(player.x-16, player.y-22); fire(player.x+16, player.y-22);} 
      if(player.power>1) { fire(player.x, player.y-28, -850); }
      player.cd = player.twin?0.11:0.18;
    }
  }
  function fire(x,y,vy=-700){ bullets.push({x,y,vy,w:4,h:10}); }

  // --- Enemy formation
  function spawnWave(stage=1){
    enemies.length=0; ebullets.length=0; drops.length=0;
    const rows = 5 + Math.min(2,stage); const cols = 10;
    const ox = 140, oy = 120; const gapX=48, gapY=46;
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        enemies.push({
          x: ox + c*gapX, y: oy + r*gapY, baseX: ox + c*gapX, baseY: oy + r*gapY,
          t: rnd(Math.PI*2), hp: r<1?3:1, kind: r<1? 'boss' : (r<2? 'elite':'grunt'),
        });
      }
    }
  }
  function enemyUpdate(e,dt){
    // gentle sine hover
    e.t += dt; e.x = e.baseX + Math.sin(e.t*2 + e.baseX*0.02)*10; e.y = e.baseY + Math.cos(e.t*2 + e.baseX*0.015)*6;
    // chance to dive
    if(Math.random()<0.0015+ui.stage*0.0002){ e.baseY += 90; if(Math.random()<0.6) enemyShoot(e); }
  }
  function enemyShoot(e){ ebullets.push({x:e.x, y:e.y+12, vy:280+ui.stage*10, w:4, h:12}); }

  function drawEnemy(e){
    X.save(); X.translate(e.x,e.y);
    if(e.kind==='boss'){
      X.fillStyle='#8ef'; X.beginPath(); X.moveTo(0,-18); X.lineTo(18,0); X.lineTo(0,18); X.lineTo(-18,0); X.closePath(); X.fill();
      X.fillStyle='#2cf'; X.fillRect(-5,-6,10,12);
    } else if(e.kind==='elite'){
      X.fillStyle='#ffd166'; X.fillRect(-12,-10,24,20);
      X.fillStyle='#ff9f1c'; X.fillRect(-4,-4,8,8);
    } else {
      X.fillStyle='#9ef'; X.fillRect(-10,-8,20,16);
    }
    X.restore();
  }

  // --- Particles & drops
  function boom(x,y,color='#fff',n=14){
    for(let i=0;i<n;i++){
      particles.push({x,y,vx:rnd(180,-180),vy:rnd(-220,220),life:rnd(0.6,0.3),color});
    }
  }
  function drawParticles(dt){
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i]; p.life-=dt; p.x+=p.vx*dt; p.y+=p.vy*dt; p.vy+=280*dt;
      X.globalAlpha=Math.max(0,p.life*1.2); X.fillStyle=p.color; X.fillRect(p.x,p.y,3,3);
      if(p.life<=0) particles.splice(i,1);
    } X.globalAlpha=1;
  }

  function spawnDrop(x,y){
    const type = Math.random()<0.5? 'twin' : 'power';
    drops.push({x,y,vy:120,w:16,h:16,type, t:0});
  }
  function drawDrop(d){
    X.save(); X.translate(d.x,d.y); d.t+=0.2; X.rotate(Math.sin(d.t)*0.3);
    if(d.type==='twin'){ X.strokeStyle='#9cf'; X.strokeRect(-8,-8,16,16); X.beginPath(); X.moveTo(-6,0); X.lineTo(0,-6); X.lineTo(6,0); X.stroke(); }
    else { X.strokeStyle='#94f7a6'; X.strokeRect(-8,-8,16,16); X.beginPath(); X.moveTo(-6,4); X.lineTo(0,-6); X.lineTo(6,4); X.stroke(); }
    X.restore();
  }

  // --- Collision helper
  function hit(a,b){ return Math.abs(a.x-b.x) < ( (a.w||0)+(b.w||0) )/2 && Math.abs(a.y-b.y) < ( (a.h||0)+(b.h||0) )/2; }

  // --- Input
  addEventListener('keydown',e=>{ if(['ArrowLeft','a','A'].includes(e.key))K.Left=true; if(['ArrowRight','d','D'].includes(e.key))K.Right=true; if([' ','ArrowUp'].includes(e.key))K.Fire=true; if(e.key==='p'||e.key==='P') ui.paused=!ui.paused; });
  addEventListener('keyup',e=>{ if(['ArrowLeft','a','A'].includes(e.key))K.Left=false; if(['ArrowRight','d','D'].includes(e.key))K.Right=false; if([' ','ArrowUp'].includes(e.key))K.Fire=false; });
  document.getElementById('restart').onclick=()=>reset();

  // --- Loop
  let t=0, lt=0; reset();
  function reset(){
    ui.score=0; ui.lives=3; ui.stage=1; player.x=S.W/2; player.twin=false; player.power=1; player.inv=0; bullets.length=ebullets.length=enemies.length=particles.length=drops.length=0; spawnWave(1);
  }

  function nextStage(){ ui.stage++; spawnWave(ui.stage); player.twin=false; player.power=1; player.inv=0.8; }

  function loop(ts){
    requestAnimationFrame(loop); if(ui.paused) return drawPaused();
    if(!lt) lt = ts; const dt = Math.min(0.033, (ts-lt)/1000); lt = ts; t += dt;

    // Clear
    X.setTransform(1,0,0,1,0,0); X.clearRect(0,0,S.W,S.H);

    drawStars(dt);
    playerUpdate(dt); playerDraw();

    // Bullets
    for(let i=bullets.length-1;i>=0;i--){ const b=bullets[i]; b.y += b.vy*dt; X.fillStyle='#fff'; X.fillRect(b.x-1,b.y-8,2,12); if(b.y<-20) bullets.splice(i,1); }

    // Enemy bullets
    for(let i=ebullets.length-1;i>=0;i--){ const b=ebullets[i]; b.y += b.vy*dt; X.fillStyle='#ff7b7b'; X.fillRect(b.x-1,b.y-6,2,10); if(b.y>S.H+20) ebullets.splice(i,1); if(player.inv<=0 && hit(b,player)){ ebullets.splice(i,1); damagePlayer(); } }

    // Enemies
    for(let i=enemies.length-1;i>=0;i--){ const e=enemies[i]; enemyUpdate(e,dt); drawEnemy(e);
      // Enemy fires sometimes
      if(Math.random()<0.001) enemyShoot(e);
      // Collisions
      for(let j=bullets.length-1;j>=0;j--){ const b=bullets[j]; if(hit(e,b)){ bullets.splice(j,1); e.hp--; boom(e.x,e.y,'#aef',5); if(e.hp<=0){ enemies.splice(i,1); ui.score += e.kind==='boss'?150: (e.kind==='elite'?80:40); if(Math.random()<0.12) spawnDrop(e.x,e.y); break; } }
      }
    }

    // Drops
    for(let i=drops.length-1;i>=0;i--){ const d=drops[i]; d.y+=d.vy*dt; drawDrop(d); if(hit(player,d)){ drops.splice(i,1); if(d.type==='twin'){ player.twin=true; } else { player.power=Math.min(2,player.power+1); } boom(player.x,player.y-10,'#9cf',8); }
      if(d.y>S.H+30) drops.splice(i,1);
    }

    drawParticles(dt);

    // Win / Stage clear
    if(enemies.length===0) { drawBanner('STAGE CLEAR'); if(t%1<0.02) nextStage(); }

    // HUD
    document.getElementById('score').textContent = 'SCORE '+ui.score;
    document.getElementById('lives').textContent = 'LIVES '+ui.lives;
    document.getElementById('stage').textContent = 'STAGE '+ui.stage;
  }
  requestAnimationFrame(loop);

  function damagePlayer(){
    ui.lives--; boom(player.x,player.y,'#ff5577',22); player.inv=1.5; if(ui.lives<0){ gameOver(); } else { player.x=S.W/2; }
  }
  function gameOver(){ ui.paused=true; drawBanner('GAME OVER – RESTART'); }

  function drawBanner(txt){
    X.save(); X.fillStyle='rgba(0,0,0,.35)'; X.fillRect(120, S.H/2-70, S.W-240, 120);
    X.strokeStyle='rgba(255,255,255,.3)'; X.strokeRect(120, S.H/2-70, S.W-240, 120);
    X.fillStyle='#eaf2ff'; X.textAlign='center'; X.font='bold 42px system-ui'; X.fillText(txt, S.W/2, S.H/2+10);
    X.restore();
  }
  function drawPaused(){
    X.save(); X.fillStyle='rgba(0,0,0,.5)'; X.fillRect(0,0,S.W,S.H);
    X.fillStyle='#eaf2ff'; X.textAlign='center'; X.font='bold 40px system-ui'; X.fillText('PAUSED', S.W/2, S.H/2);
    X.restore();
  }
  </script>
</body>
</html>
